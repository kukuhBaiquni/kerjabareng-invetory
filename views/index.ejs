<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>



    <button type="button" class="btn btn-primary" id="buttonAdd">

      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>

      Tambah Barang</button>

      <br>
      <br>

      <!-- <form style="display: none" id="formAdd" class="form-inline" role="form"> -->
      <div id="formAdd" class="form-inline" style="display: none">
          <div  class="form-group">
            <label class="sr-only" for="nama">Nama Barang</label>
            <input style="width: 400px" type="text" class="form-control" id="nama" placeholder="Masukkan Nama Barang">
          </div>
          <button id="submitNama"  class="btn btn-primary">Save</button>
      </div>


      <!-- </form> -->


    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>id</th>
          <th>Nama Barang</th>
          <th>Stok tersedia</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>Obat Batuk</td>
          <td>10</td>
          <td>
            <button type="button" class="btn btn-primary">Ubah</button>
            <button type="button" class="btn btn-danger">Hapus</button>
          </td>
        </tr>
      </tbody>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script>
      $(document).ready(function () {
        console.log('ready!');
        getData();

        function getData() {
          $.ajax({
            url: '/list',
            contentType: 'application/json',
            success: function (response) {
              console.log(response);
              var tbodyEl = $('tbody');

              tbodyEl.html('');

              response.data.forEach(function (data) {
                tbodyEl.append('\
                  <tr>\
                    <td class="id"><a href="editjumlah/' + data._id + '"> '+data._id+'<a></td>\
                    <td class="valnama"> ' + data.nama + '</td>\
                    <td class="tdnama" style="display: none"><input type="text" class="nama form-control" value=" ' + data.nama + ' "></td>\
                    <td class="jumlah"> ' + data.jumlah + '</td>\
                    <td>\
                      <button class="btn btn-primary update-button"> UPDATE </button>\
                      <button style="display: none" class="btn btn-success save-button"> SAVE </button>\
                      <button class="btn btn-danger">DELETE</button>\
                    </td>\
                  </tr>\
                ');
              });
            }
          });
        }
        $('#buttonAdd').on('click', function () {
          $('#formAdd').toggle();
        })

        $('#submitNama').on('click', function () {

          var nama = $('#nama');
          console.log(nama.val());

          $.ajax({
            url: '/add',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ nama: nama.val() }),
            success: function (response) {
              console.log(response);
              nama.val('');
              // $('#get-data').click();
              getData();
            }
          })
        })



        $('table').on('click', '.update-button', function () {
          var rowEl = $(this).closest('tr');
          var valnama = rowEl.find('.valnama').hide();
          var tdnama = rowEl.find('.tdnama').show();
          var saveButton = rowEl.find('.save-button').show();
          var updateButton = rowEl.find('.update-button').hide();
        })

        $('table').on('click', '.save-button', function () {
          var rowEl = $(this).closest('tr');
          var id = rowEl.find('.id').text();
          var nama = rowEl.find('.nama').val();
          id = id.trim();

          console.log(id);

          $.ajax({
            url: '/update/'+id,
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify({ nama: nama }),
            success: function (response) {
              console.log(response);
              getData();
            }
          })
        })
      })

    </script>

  </body>
</html>
